<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通讯录管理</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h2>通讯录管理</h2>

        <div class="contact-list">
            <h3>联系人列表</h3>
            <div id="contactContainer">
                <p style="text-align: center; color: #718096;">加载中...</p>
            </div>
        </div>

        <div class="btn-group">
            <a href="add.html"><button class="add-btn">添加联系人</button></a>
        </div>
    </div>

    <script>
        const API_URL = "http://121.43.124.28:7894/api/contacts"; // 端口改为7894
        const BACKEND_BASE_URL = "http://121.43.124.28:7894"; // 端口改为7894

        window.onload = getContacts;

        async function getContacts() {
            try {
                const response = await fetch(API_URL, { method: 'GET' });
                const data = await response.json();
                const container = document.getElementById('contactContainer');

                if (data.code === 200) {
                    if (data.data.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: #718096;">暂无联系人数据</p>';
                        return;
                    }

                    let html = '';
                    data.data.forEach(contact => {
                        html += `
                            <div class="contact-item">
                                <div class="contact-info">
                                    姓名：${contact.name} | 电话：${contact.phone}
                                </div>
                                <div class="btn-group">
                                    <a href="edit.html?id=${contact.id}" class="modify-btn">修改联系人</a>
                                    <button class="delete-btn" data-id="${contact.id}">删除联系人</button>
                                </div>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                    bindDeleteEvents();
                } else {
                    container.innerHTML = `<p style="text-align: center; color: #e53e3e;">${data.message || '数据获取失败'}</p>`;
                }
            } catch (error) {
                document.getElementById('contactContainer').innerHTML =
                    '<p style="text-align: center; color: #e53e3e;">无法连接后端服务器</p>';
                console.error('获取联系人失败：', error);
            }
        }

        function bindDeleteEvents() {
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const id = this.getAttribute('data-id');
                    if (confirm('确定要删除吗？')) {
                        try {
                            const response = await fetch(
                                `${BACKEND_BASE_URL}/api/contacts/${id}/delete`,
                                { method: 'DELETE' }
                            );
                            const data = await response.json();
                            alert(data.message || '操作失败');
                            getContacts();
                        } catch (error) {
                            console.error('删除失败：', error);
                            alert('删除失败，无法连接服务器');
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>